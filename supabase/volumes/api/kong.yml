_format_version: "2.1"
_transform: true

# NOTE: Replace these placeholder keys with your actual Supabase JWT keys
# Generate keys using: https://supabase.com/docs/guides/self-hosting
consumers:
  - username: anon
    keyauth_credentials:
      - key: YOUR_SUPABASE_ANON_KEY_HERE
  - username: service_role
    keyauth_credentials:
      - key: YOUR_SUPABASE_SERVICE_KEY_HERE

acls:
  - consumer: anon
    group: anon
  - consumer: service_role
    group: admin

services:
  - name: auth-v1-open
    url: http://supabase-auth:9999/verify
    plugins:
      - name: cors
        config:
          origins:
            - "*"
          methods:
            - GET
            - HEAD
            - PUT
            - PATCH
            - POST
            - DELETE
          headers:
            - Accept
            - Accept-Version
            - Content-Length
            - Content-MD5
            - Content-Type
            - Date
            - X-Auth-Token
            - Authorization
            - X-Requested-With
            - Access-Control-Allow-Origin
            - x-client-info
          exposed_headers:
            - X-Request-Id
          credentials: true
          max_age: 3600

  - name: auth-v1-open-callback
    url: http://supabase-auth:9999/callback
    plugins:
      - name: cors
        config:
          origins:
            - "*"
          methods:
            - GET
            - HEAD
            - PUT
            - PATCH
            - POST
            - DELETE
          headers:
            - Accept
            - Accept-Version
            - Content-Length
            - Content-MD5
            - Content-Type
            - Date
            - X-Auth-Token
            - Authorization
            - X-Requested-With
            - Access-Control-Allow-Origin
            - x-client-info
          exposed_headers:
            - X-Request-Id
          credentials: true
          max_age: 3600

  - name: auth-v1-s3
    url: http://supabase-auth:9999/s3
    plugins:
      - name: cors
        config:
          origins:
            - "*"
          methods:
            - GET
            - HEAD
            - PUT
            - PATCH
            - POST
            - DELETE
          headers:
            - Accept
            - Accept-Version
            - Content-Length
            - Content-MD5
            - Content-Type
            - Date
            - X-Auth-Token
            - Authorization
            - X-Requested-With
            - Access-Control-Allow-Origin
            - x-client-info
          exposed_headers:
            - X-Request-Id
          credentials: true
          max_age: 3600

  - name: auth-v1
    url: http://supabase-auth:9999/
    plugins:
      - name: cors
        config:
          origins:
            - "*"
          methods:
            - GET
            - HEAD
            - PUT
            - PATCH
            - POST
            - DELETE
          headers:
            - Accept
            - Accept-Version
            - Content-Length
            - Content-MD5
            - Content-Type
            - Date
            - X-Auth-Token
            - Authorization
            - X-Requested-With
            - Access-Control-Allow-Origin
            - x-client-info
          exposed_headers:
            - X-Request-Id
          credentials: true
          max_age: 3600
      - name: key-auth
        config:
          hide_credentials: false

  - name: rest-v1
    url: http://supabase-rest:3000/
    plugins:
      - name: cors
        config:
          origins:
            - "*"
          methods:
            - GET
            - HEAD
            - PUT
            - PATCH
            - POST
            - DELETE
          headers:
            - Accept
            - Accept-Version
            - Content-Length
            - Content-MD5
            - Content-Type
            - Date
            - X-Auth-Token
            - Authorization
            - X-Requested-With
            - Access-Control-Allow-Origin
            - x-client-info
          exposed_headers:
            - X-Request-Id
          credentials: true
          max_age: 3600
      - name: key-auth
        config:
          hide_credentials: false

  - name: realtime-v1
    url: http://supabase-realtime:4000/socket
    plugins:
      - name: cors
        config:
          origins:
            - "*"
          methods:
            - GET
            - HEAD
            - PUT
            - PATCH
            - POST
            - DELETE
          headers:
            - Accept
            - Accept-Version
            - Content-Length
            - Content-MD5
            - Content-Type
            - Date
            - X-Auth-Token
            - Authorization
            - X-Requested-With
            - Access-Control-Allow-Origin
            - x-client-info
          exposed_headers:
            - X-Request-Id
          credentials: true
          max_age: 3600
      - name: key-auth
        config:
          hide_credentials: false

  - name: meta
    url: http://supabase-meta:8080/
    plugins:
      - name: key-auth
        config:
          hide_credentials: false

routes:
  - service: auth-v1-open
    strip_path: true
    paths:
      - /auth/v1/verify

  - service: auth-v1-open-callback
    strip_path: true
    paths:
      - /auth/v1/callback

  - service: auth-v1-s3
    strip_path: true
    paths:
      - /auth/v1/s3

  - service: auth-v1
    strip_path: true
    paths:
      - /auth/v1/

  - service: rest-v1
    strip_path: true
    paths:
      - /rest/v1/

  - service: realtime-v1
    strip_path: true
    paths:
      - /realtime/v1/

  - service: meta
    strip_path: true
    paths:
      - /pg/